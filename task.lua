local a=require"term.colors"local function b(c,...)error"NYI"end;local d;local function e(f)return setmetatable({__name=f,run=function()end,options={}},d)end;d={__div=function(g,h)return e("("..g.__name.." / "..h.__name..")"):perform(function(self,...)return b({g.run,h.run},...)end):option("quiet",true)end,__concat=function(g,h)return e("("..g.__name.." .. "..h.__name..")"):perform(function(self,...)return g:run(...),h:run(...)end):option("quiet",true)end,__band=function(g,h)return e("("..g.__name.." & "..h.__name..")"):perform(function(self,...)local i=g:run(...)if i then return i,h:run(...)end end):option("quiet",true)end,__bor=function(g,h)return e("("..g.__name.." | "..h.__name..")"):perform(function(self,...)return g:run(...)or h:run(...)end):option("quiet",true)end,__shr=function(g,h)return e("("..g.__name.." >> "..h.__name..")"):perform(function(self,...)return h:run(g:run(...))end):option("quiet",true)end,__shl=function(h,g)return h>>g end,__bxor=function(g,h)return e("("..g.__name.." ~ "..h.__name..")"):perform(function(self,...)local j={g:run(...)}return#j>0 and h:run(table.unpack(j))end):option("quiet",true)end,__mul=function(g,h)return e("("..g.__name.." * "..h.__name..")"):perform(function(self,...)local k={}for l,m in ipairs{g:run(...)}do local n=h:run(m)if n~=nil then table.insert(k,n)end end;return table.unpack(k)end):option("quiet",true)end,__pow=function(g,o)return e(g.__name.." ^ ("..tostring(o)..")"):perform(function(self,...)local p,q;if type(o)=="function"then p,q=o(...)else p=o end;if p then return g:run(...)else local r={}for l,s in ipairs{...}do table.insert(r,tostring(s))end;print(a.yellow("\nTask "..g.__name.." ignored: "..q))end end):option("quiet",true)end,__call=function(self,...)self.options={...}return self end,__index={description=function(self,t)self.__description=t;return self end,name=function(self,f)self.__name=f;return self end,perform=function(self,u)self.run=function(self,...)local v=os.clock()if not self.options.quiet then print(a.green("\nðŸŒ¿ Running task "..a.bright(a.blue(self.__name))..a.green.." for "..a.bright(a.yellow(table.concat({...},", "))))..(self.__description and a.dim(a.cyan("\n"..self.__description))or""))end;local k={u(self,...)}if not self.options.quiet then print("\tTask "..a.bright(a.blue(self.__name)).." completed with "..a.yellow(#k).." result"..(#k>1 and"s"or"").." in "..a.yellow(string.format("%.03f",os.clock()-v).."s"))for l,w in ipairs(k)do print("\t\tâ†’ "..a.dim(a.cyan(tostring(w))))end end;return table.unpack(k)end;return self end,option=function(self,f,x)local y=type(f)=="table"and f or{[f]=x}for z,A in pairs(y)do self.options[z]=A end;return self end,opt=function(self,...)return self:option(...)end,perf=function(self,...)return self:perform(...)end,desc=function(self,...)return self:description(...)end},__tostring=function(self)return"Task "..self.__name end}d.parallelTo=d.__div;d.after=d.__concat;d.success=d.__band;d.failure=d.__bor;d.into=d.__shr;d.ouput=d.__bxor;d.each=d.__mul;d.meet=d.__pow;return e
